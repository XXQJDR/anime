<template>
	<div class="animeRandom">
		<!-- region 模块分类名称 -->
		<div class="typeTitle">
			<svg t="1741332391116" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12388" id="mx_n_1741332391116">
				<path d="M409.6 473.6h-18.176a12.8 12.8 0 0 1 0-25.6H409.6a37.888 37.888 0 0 0 34.816-22.528 12.8 12.8 0 0 1 17.152-6.144 12.544 12.544 0 0 1 6.144 16.896A63.488 63.488 0 0 1 409.6 473.6z m-94.976 0h-76.8a12.8 12.8 0 0 1 0-25.6h76.8a12.8 12.8 0 0 1 0 25.6z m-153.6 0h-76.8a12.8 12.8 0 1 1 0-25.6h76.8a12.8 12.8 0 0 1 0 25.6zM25.6 433.152a12.288 12.288 0 0 1-12.288-9.984A59.648 59.648 0 0 1 12.8 409.6v-65.792a12.8 12.8 0 0 1 25.6 0V409.6a44.288 44.288 0 0 0 0 8.192 12.544 12.544 0 0 1-9.728 15.104z m435.2-65.536a12.8 12.8 0 0 1-12.8-12.8v-76.8a12.8 12.8 0 0 1 25.6 0v76.8a12.8 12.8 0 0 1-12.8 12.8zM25.6 279.808a12.8 12.8 0 0 1-12.8-12.8v-76.8a12.8 12.8 0 0 1 25.6 0v76.8a12.8 12.8 0 0 1-12.8 12.8z m435.2-65.792a12.8 12.8 0 0 1-12.8-12.8v-76.8a12.8 12.8 0 1 1 25.6 0v76.8a12.8 12.8 0 0 1-12.8 12.8zM25.6 126.208a12.8 12.8 0 0 1-12.8-12.8V76.8a64.256 64.256 0 0 1 18.688-45.312 13.056 13.056 0 0 1 18.176 0 13.056 13.056 0 0 1 0 18.176A38.4 38.4 0 0 0 38.4 76.8v36.608a12.8 12.8 0 0 1-12.8 12.8z m427.008-64.256a13.056 13.056 0 0 1-10.752-5.888A38.4 38.4 0 0 0 409.6 38.4h-25.6a12.8 12.8 0 0 1 0-25.6h25.6a63.744 63.744 0 0 1 53.76 29.44 12.544 12.544 0 0 1-3.84 17.664 12.8 12.8 0 0 1-6.912 2.048zM307.2 38.4H230.4a12.8 12.8 0 0 1 0-25.6h76.8a12.8 12.8 0 0 1 0 25.6z m-153.6 0H76.8a12.8 12.8 0 0 1 0-25.6h76.8a12.8 12.8 0 0 1 0 25.6zM947.2 1011.2h-18.176a12.8 12.8 0 1 1 0-25.6H947.2a38.4 38.4 0 0 0 35.072-22.528 12.544 12.544 0 0 1 16.896-6.144 12.8 12.8 0 0 1 6.4 16.896A64.256 64.256 0 0 1 947.2 1011.2z m-94.976 0h-76.8a12.8 12.8 0 1 1 0-25.6h76.8a12.8 12.8 0 0 1 0 25.6z m-153.6 0h-76.8a12.8 12.8 0 0 1 0-25.6h76.8a12.8 12.8 0 0 1 0 25.6zM563.2 970.752a12.544 12.544 0 0 1-12.288-9.984 59.648 59.648 0 0 1-0.512-13.568v-65.792a12.8 12.8 0 0 1 25.6 0V947.2a28.672 28.672 0 0 0 0 8.192 12.8 12.8 0 0 1-9.984 15.104z m435.2-65.536a12.8 12.8 0 0 1-12.8-12.8v-76.8a12.8 12.8 0 0 1 25.6 0v76.8a12.8 12.8 0 0 1-12.8 12.8z m-435.2-87.808a12.8 12.8 0 0 1-12.8-12.8v-76.8a12.8 12.8 0 0 1 25.6 0v76.8a12.8 12.8 0 0 1-12.8 12.8z m435.2-65.792a12.8 12.8 0 0 1-12.8-12.8v-76.8a12.8 12.8 0 0 1 25.6 0v76.8a12.8 12.8 0 0 1-12.8 12.8z m-435.2-87.808a12.8 12.8 0 0 1-12.8-12.8V614.4a63.744 63.744 0 0 1 18.688-45.312 12.8 12.8 0 0 1 18.176 18.176A38.4 38.4 0 0 0 576 614.4v36.608a12.8 12.8 0 0 1-12.8 12.8z m427.008-64.256a13.056 13.056 0 0 1-10.752-5.888A38.4 38.4 0 0 0 947.2 576h-25.6a12.8 12.8 0 0 1 0-25.6h25.6a63.744 63.744 0 0 1 53.76 29.44 12.544 12.544 0 0 1-3.84 17.664 12.8 12.8 0 0 1-6.912 2.048zM844.8 576h-76.8a12.8 12.8 0 0 1 0-25.6h76.8a12.8 12.8 0 0 1 0 25.6z m-153.6 0h-76.8a12.8 12.8 0 0 1 0-25.6h76.8a12.8 12.8 0 0 1 0 25.6z" p-id="12389"></path>
				<path d="M563.2 25.6m51.2 0l332.8 0q51.2 0 51.2 51.2l0 332.8q0 51.2-51.2 51.2l-332.8 0q-51.2 0-51.2-51.2l0-332.8q0-51.2 51.2-51.2Z" fill-opacity=".5" p-id="12390"></path>
				<path d="M947.2 473.6H614.4a64 64 0 0 1-64-64V76.8A64 64 0 0 1 614.4 12.8h332.8A64 64 0 0 1 1011.2 76.8v332.8a64 64 0 0 1-64 64z m-332.8-435.2A38.4 38.4 0 0 0 576 76.8v332.8a38.4 38.4 0 0 0 38.4 38.4h332.8a38.4 38.4 0 0 0 38.4-38.4V76.8A38.4 38.4 0 0 0 947.2 38.4z" p-id="12391"></path>
				<path d="M25.6 563.2m51.2 0l332.8 0q51.2 0 51.2 51.2l0 332.8q0 51.2-51.2 51.2l-332.8 0q-51.2 0-51.2-51.2l0-332.8q0-51.2 51.2-51.2Z" fill-opacity=".5" p-id="12392"></path>
				<path d="M409.6 1011.2H76.8A64 64 0 0 1 12.8 947.2V614.4A64 64 0 0 1 76.8 550.4h332.8a64 64 0 0 1 64 64v332.8a64 64 0 0 1-64 64z m-332.8-435.2A38.4 38.4 0 0 0 38.4 614.4v332.8A38.4 38.4 0 0 0 76.8 985.6h332.8a38.4 38.4 0 0 0 38.4-38.4V614.4a38.4 38.4 0 0 0-38.4-38.4z" p-id="12393"></path>
			</svg>
			<div class="title">随机动漫</div>
		</div>
		<!-- endregion -->

		<!-- region 随机模块 -->
		<div class="box">
			<div class="anime" v-loading="loading">
				<div class="img" v-show="anime.cover">
					<img v-lazy="anime.cover" alt="">
					<div class="mask" @click="addWatching(anime.animeUserId)">
						<div class="box">
							<svg width="25px" height="25px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
								<path d="M612.37248 411.62752V30.208h-200.74496v381.41952H30.208v200.74496h381.41952v381.41952h200.74496V612.37248h381.41952v-200.74496z"/>
							</svg>
						</div>
					</div>
				</div>
				<div class="info" v-show="anime.name!=null">
					<h3>{{anime.name}}</h3>
					<div>动画种类：{{anime.kind}}</div>
					<div>首播时间：{{anime.firstPlayDate}}</div>
					<div>播放状态：{{anime.playStatus}}</div>
					<div>原作：{{anime.original}}</div>
					<div>剧情类型：{{anime.storyType}}</div>
					<div>制作公司：{{anime.company}}</div>
					<el-tooltip effect="dark" :content="anime.description" placement="top" :visible-arrow="false">
						<div class="intro">简介：{{anime.description}}</div>
					</el-tooltip>
				</div>
			</div>
			<div class="control">
				<div class="btn" @click="randomAnime">随机</div>
			</div>
		</div>
		<!-- endregion -->
	</div>
</template>

<script>
import {reqRandomAnime, reqUpdateAnimeWatchStatus} from "@/api";
import _ from "lodash";

export default {
	name: 'AnimeRandom',
	data() {
		return {
			//加载动画开启标志，true代表开启
			loading: false,

			//随机到的动漫
			anime: {}
		}
	},
	methods: {
		randomAnime: _.throttle(async function () {
			try {
				//开启加载动画
				this.loading = true;

				//获取数据
				let result = await reqRandomAnime();
				if (result.code !== 200) {
					this.$message.error(result.msg);
					return;
				}
				this.anime = result.data || {};

				//无未看动漫
				if (this.anime.name == null) {
					this.$message.warning('您的列表里没有一个未看的动漫，快去添加吧！')
				}
			} finally {
				//关闭加载动画
				this.loading = false;
			}
		}, 1000),

		//将动漫标记为正在观看
		async addWatching(animeUserId) {
			let result = await reqUpdateAnimeWatchStatus(animeUserId, null, null, null, 'WATCHING', null, null);
			if (result.code !== 200) {
				this.$message.error('添加到正在观看失败！');
				return;
			}

			this.$message.success('成功添加到正在观看列表！');
		}
	},
}
</script>

<style scoped lang="scss">
.animeRandom {
	/* 模块分类名称 */
	.typeTitle {
		min-width: 110px;
		font-size: 1.5rem;
		display: flex;
		align-items: center;
		margin-left: 1rem;

		@media screen and (max-width: 768px) {
			margin-left: 6px;
		}

		svg {
			width: 22px;
			height: 22px;
			fill: #000000;
			stroke: #000000;
			stroke-width: 20px;
		}

		div {
			min-width: 76px;
			margin-left: 15px;
			font-weight: bold;
		}
	}

	/* 随机模块 */
	> .box {
		margin-top: 3rem;

		.anime {
			min-height: 350px;
			display: flex;
			align-items: center;
			padding: 15px;
			background-color: #FFFFFF;
			box-shadow: 0 0 35px 0 rgba(154, 161, 171, .15);
			border-radius: 10px;
			box-sizing: border-box;

			@media screen and (max-width: 768px) {
				min-height: 300px;
				padding: 10px;
			}

			.img {
				width: 165px;
				height: 235px;
				border-radius: 10px;
				overflow: hidden;
				position: relative;
				cursor: pointer;

				@media screen and (max-width: 768px) {
					width: 122px;
					height: 170px;
				}

				@media screen and (min-width: 768px) {
					&:hover {
						/* 鼠标移入图片展示遮罩 */
						.mask {
							opacity: 1;
						}

						/* 鼠标移入图片，图片放大 */
						img {
							transform: scale(1.1);
						}
					}

					/* 鼠标移入添加按钮，添加按钮旋转 */
					.mask .box:hover {
						transform: rotateZ(180deg);
					}
				}

				img {
					width: 100%;
					height: 100%;
					object-fit: cover;
					transition: transform 0.3s;
				}

				.mask {
					width: 100%;
					height: 100%;
					background-color: rgba(0, 0, 0, .4);
					position: absolute;
					top: 0;
					left: 0;
					opacity: 0;
					transition: opacity 0.3s;

					.box {
						width: 50px;
						height: 50px;
						background-color: rgba(0, 0, 0, .5);
						border-radius: 50%;
						position: absolute;
						top: 0;
						bottom: 0;
						left: 0;
						right: 0;
						margin: auto;
						transition: all .5s;

						svg {
							position: absolute;
							top: 0;
							bottom: 0;
							left: 0;
							right: 0;
							margin: auto;
							fill: #FFFFFF;
						}
					}
				}
			}

			.info {
				flex: 1;
				padding-left: 15px;

				div {
					margin-top: 8px;
				}

				.intro {
					word-break: break-all;
					overflow: hidden;
					display: -webkit-box;
					-webkit-line-clamp: 3;
					-webkit-box-orient: vertical;

					@media screen and (max-width: 768px) {
						-webkit-line-clamp: 5;
					}
				}
			}
		}

		.control {
			margin-top: 3rem;

			.btn {
				width: 90px;
				height: 40px;
				padding: 10px;
				text-align: center;
				line-height: 40px;
				border-radius: 10px;
				background-image: linear-gradient(92.91deg, rgb(51, 0, 217) 2.18%, rgb(157, 32, 201) 44.94%, rgb(223, 122, 108) 99.91%);
				background-size: 400%;
				color: #FFFFFF;
				cursor: pointer;
				margin: 0 auto;
				transition: background-size .3s;

				&:hover {
					background-size: 200%;
				}
			}
		}
	}
}
</style>